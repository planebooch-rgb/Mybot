<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal AI Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="bg-[#131314] text-gray-200 h-screen flex overflow-hidden font-sans">

    <aside id="sidebar" class="w-72 bg-[#1e1f20] h-full flex flex-col transition-all duration-300">
        <div class="p-4">
            <button onclick="createNewChat()" class="w-full flex items-center gap-3 px-4 py-3 bg-[#2b2c2d] hover:bg-[#37393b] rounded-full text-sm transition">
                <i class="fa-solid fa-plus"></i> New Chat
            </button>
        </div>
        
        <div id="chat-list" class="flex-1 overflow-y-auto px-3 space-y-1">
            </div>

        <div class="p-4 border-t border-gray-700">
            <button onclick="toggleModal('settings-modal')" class="w-full flex items-center gap-3 px-4 py-2 hover:bg-[#2b2c2d] rounded-lg text-sm">
                <i class="fa-solid fa-gear"></i> Settings
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative h-full">
        <header class="p-4 flex justify-between items-center bg-[#131314]/80 backdrop-blur-md sticky top-0 z-10">
            <div class="flex items-center gap-3">
                <button onclick="toggleSidebar()" class="p-2 hover:bg-gray-800 rounded-lg lg:hidden">
                    <i class="fa-solid fa-bars"></i>
                </button>
                <h1 class="text-xl font-medium" id="current-model-display">Gemini Pro</h1>
            </div>
        </header>

        <div id="chat-container" class="flex-1 overflow-y-auto p-4 md:p-8 space-y-6 scroll-smooth">
            <div id="welcome-screen" class="h-full flex flex-col items-center justify-center text-center space-y-4">
                <div class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">Hello, User</div>
                <p class="text-gray-400">How can I help you today?</p>
            </div>
        </div>

        <div class="p-4 bg-[#131314]">
            <div class="max-w-4xl mx-auto relative">
                <textarea id="user-input" rows="1" 
                    class="w-full bg-[#1e1f20] text-white rounded-2xl py-4 pl-6 pr-14 focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none overflow-hidden"
                    placeholder="Enter a prompt here..."
                    oninput="this.style.height = '';this.style.height = this.scrollHeight + 'px'"></textarea>
                <button onclick="handleSendMessage()" class="absolute right-4 bottom-3.5 p-2 text-blue-400 hover:bg-gray-800 rounded-full transition">
                    <i class="fa-solid fa-paper-plane text-lg"></i>
                </button>
            </div>
            <p class="text-center text-[10px] text-gray-500 mt-2">AI may display inaccurate info. Check your API settings.</p>
        </div>
    </main>

    <div id="settings-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm">
        <div class="bg-[#1e1f20] w-full max-w-md p-6 rounded-2xl shadow-2xl border border-gray-700">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold">Settings</h2>
                <button onclick="toggleModal('settings-modal')" class="text-gray-400 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            </div>
            
            <div class="space-y-4 text-sm">
                <div>
                    <label class="block mb-1 text-gray-400">OpenRouter API Key</label>
                    <input type="password" id="api-key" class="w-full bg-[#131314] border border-gray-700 rounded-lg p-2.5 focus:ring-1 focus:ring-blue-500 outline-none" placeholder="sk-or-v1-...">
                </div>
                <div>
                    <label class="block mb-1 text-gray-400">Model Name</label>
                    <input type="text" id="model-name" class="w-full bg-[#131314] border border-gray-700 rounded-lg p-2.5 focus:ring-1 focus:ring-blue-500 outline-none" placeholder="google/gemini-pro-1.5">
                </div>
                <div>
                    <label class="block mb-1 text-gray-400">System Prompt</label>
                    <textarea id="system-prompt" class="w-full bg-[#131314] border border-gray-700 rounded-lg p-2.5 focus:ring-1 focus:ring-blue-500 outline-none h-24" placeholder="You are a helpful assistant..."></textarea>
                </div>
                <button onclick="saveSettings()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 rounded-lg mt-4 transition">Save Configuration</button>
            </div>
        </div>
    </div>

    <script>
        // --- Core Logic ---
        let state = {
            currentChatId: Date.now(),
            history: JSON.parse(localStorage.getItem('chatHistory')) || [],
            settings: JSON.parse(localStorage.getItem('chatSettings')) || {
                apiKey: '',
                model: 'google/gemini-2.0-flash-exp:free',
                systemPrompt: 'You are a helpful AI assistant.'
            }
        };

        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');

        function init() {
            document.getElementById('api-key').value = state.settings.apiKey;
            document.getElementById('model-name').value = state.settings.model;
            document.getElementById('system-prompt').value = state.settings.systemPrompt;
            document.getElementById('current-model-display').innerText = state.settings.model.split('/').pop();
            renderHistory();
        }

        // --- UI Functions ---
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('-ml-72');
        }

        function toggleModal(id) {
            document.getElementById(id).classList.toggle('hidden');
        }

        function createNewChat() {
            state.currentChatId = Date.now();
            chatContainer.innerHTML = '';
            showWelcome();
        }

        function showWelcome() {
            chatContainer.innerHTML = `
                <div id="welcome-screen" class="h-full flex flex-col items-center justify-center text-center space-y-4">
                    <div class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">Hello, User</div>
                    <p class="text-gray-400">How can I help you today?</p>
                </div>`;
        }

        function appendMessage(role, text) {
            const welcome = document.getElementById('welcome-screen');
            if(welcome) welcome.remove();

            const msgDiv = document.createElement('div');
            msgDiv.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} animate-fade-in`;
            
            const inner = `
                <div class="max-w-[85%] px-5 py-3 rounded-2xl ${role === 'user' ? 'bg-[#2b2c2d]' : 'bg-transparent'}">
                    <div class="text-xs font-bold mb-1 uppercase tracking-wider text-gray-500">${role}</div>
                    <div class="prose prose-invert leading-relaxed">${text.replace(/\n/g, '<br>')}</div>
                </div>`;
            
            msgDiv.innerHTML = inner;
            chatContainer.appendChild(msgDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // --- Logic & API ---
        async function handleSendMessage() {
            const text = userInput.value.trim();
            if (!text || !state.settings.apiKey) {
                if(!state.settings.apiKey) alert("Please add your API key in Settings");
                return;
            }

            userInput.value = '';
            userInput.style.height = 'auto';
            appendMessage('user', text);

            // Preparation for API call
            const currentMessages = [
                { role: "system", content: state.settings.systemPrompt },
                { role: "user", content: text }
            ];

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${state.settings.apiKey}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "model": state.settings.model,
                        "messages": currentMessages
                    })
                });

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                
                appendMessage('assistant', aiResponse);
                saveToHistory(text, aiResponse);
            } catch (error) {
                appendMessage('assistant', "Error: Check console or API key settings.");
                console.error(error);
            }
        }

        function saveSettings() {
            state.settings = {
                apiKey: document.getElementById('api-key').value,
                model: document.getElementById('model-name').value,
                systemPrompt: document.getElementById('system-prompt').value
            };
            localStorage.setItem('chatSettings', JSON.stringify(state.settings));
            document.getElementById('current-model-display').innerText = state.settings.model.split('/').pop();
            toggleModal('settings-modal');
        }

        function saveToHistory(userText, aiText) {
            const chat = {
                id: state.currentChatId,
                title: userText.substring(0, 30) + '...',
                timestamp: new Date().toLocaleTimeString()
            };
            
            // Basic history logic: avoid duplicates for the same session
            if (!state.history.find(h => h.id === chat.id)) {
                state.history.unshift(chat);
                localStorage.setItem('chatHistory', JSON.stringify(state.history));
                renderHistory();
            }
        }

        function renderHistory() {
            const list = document.getElementById('chat-list');
            list.innerHTML = state.history.map(item => `
                <div class="group flex items-center gap-3 px-4 py-2 hover:bg-[#2b2c2d] rounded-lg cursor-pointer transition">
                    <i class="fa-regular fa-message text-sm text-gray-400"></i>
                    <span class="truncate text-sm flex-1">${item.title}</span>
                </div>
            `).join('');
        }

        // Listen for Enter (but allow Shift+Enter for new lines)
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSendMessage();
            }
        });

        init();
    </script>
</body>
</html>
